syntax = "proto3";

package rpc;

service Coordinator {
  rpc Submit (SubmitRequest) returns (stream Page) {}
}

message SubmitRequest {
  string sql = 1;
}

service Worker {
  rpc Broadcast (BroadcastRequest) returns (stream Page) {}
  rpc Exchange (ExchangeRequest) returns (stream Page) {}
}

message BroadcastRequest {
  bytes expr = 1;
  map<string, bytes> variables = 2;
  int64 txn = 3;
  int32 listeners = 4;
}

message ExchangeRequest {
  bytes expr = 1;
  map<string, bytes> variables = 2;
  int64 txn = 3;
  int32 listeners = 4;
  string hash_column = 5;
  int32 hash_bucket = 6;
}

message Page {
  bytes record_batch = 1;
}