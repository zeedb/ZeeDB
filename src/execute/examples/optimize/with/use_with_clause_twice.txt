with foo as (select customer_id, store_id from customer)
select f1.customer_id, f2.customer_id
from foo f1, foo f2
where f1.store_id = f2.store_id

Script
	CreateTempTable foo customer_id INT64 store_id INT64
		Filter* (LessOrEqual $xmin (Xid)) (Less (Xid) $xmax)
			Map* customer.customer_id customer.store_id $xmin $xmax
				SeqScan customer
	Map foo.customer_id foo.customer_id
		HashJoin Inner (Equal foo.store_id foo.store_id)
			Partition* foo.store_id
				GetTempTable foo
			Partition* foo.store_id
				GetTempTable foo